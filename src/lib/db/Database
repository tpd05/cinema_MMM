CREATE TABLE person (
    id INT AUTO_INCREMENT PRIMARY KEY,
    full_name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20) UNIQUE,
    address TEXT,
    avatar VARCHAR(255) NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE account (
    id INT AUTO_INCREMENT PRIMARY KEY,
    person_id INT NOT NULL,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role ENUM('admin', 'client') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (person_id) REFERENCES person(id) ON DELETE CASCADE
);
CREATE TABLE admin (
    id INT AUTO_INCREMENT PRIMARY KEY,
    person_id INT NOT NULL,
    FOREIGN KEY (person_id) REFERENCES person(id) ON DELETE CASCADE
);
CREATE TABLE client (
    id INT AUTO_INCREMENT PRIMARY KEY,
    person_id INT NOT NULL,
    FOREIGN KEY (person_id) REFERENCES person(id) ON DELETE CASCADE
);
CREATE TABLE theaters (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    location TEXT NOT NULL,
    total_seats INT NOT NULL CHECK (total_seats > 0),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE movies (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    genre VARCHAR(100),
    duration INT NOT NULL,
    release_date DATE NOT NULL,
    ticket_price DECIMAL(10,2) NOT NULL,
    image_url VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE showtimes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    movie_id INT NOT NULL,
    theater_id INT NOT NULL,
    showtime DATETIME NOT NULL,
    FOREIGN KEY (movie_id) REFERENCES movies(id) ON DELETE CASCADE,
    FOREIGN KEY (theater_id) REFERENCES theaters(id) ON DELETE CASCADE
);
CREATE TABLE bookings (
    id INT AUTO_INCREMENT PRIMARY KEY,
    client_id INT NOT NULL,
    showtime_id INT NOT NULL,
    num_tickets INT NOT NULL CHECK (num_tickets > 0),
    total_price DECIMAL(10,2) NOT NULL,
    booking_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (client_id) REFERENCES client(id) ON DELETE CASCADE,
    FOREIGN KEY (showtime_id) REFERENCES showtimes(id) ON DELETE CASCADE
);

INSERT INTO person (full_name, email, phone, address, avatar) VALUES
('Nguyễn Văn A', 'a@gmail.com', '0912345678', 'Hà Nội, Việt Nam', 'avatar_a.jpg'),
('Trần Thị B', 'b@gmail.com', '0987654321', 'TP.HCM, Việt Nam', 'avatar_b.jpg'),
('Lê Văn C', 'c@gmail.com', '0923456789', 'Đà Nẵng, Việt Nam', 'avatar_c.jpg');

INSERT INTO account (person_id, username, password_hash, role) VALUES
(1, 'nguyenvana', 'hashed_password_1', 'admin'),
(2, 'tranthib', 'hashed_password_2', 'client'),
(3, 'levanc', 'hashed_password_3', 'client');

INSERT INTO admin (person_id) VALUES
(1);

INSERT INTO client (person_id) VALUES
(2),
(3);

INSERT INTO theaters (name, location, total_seats) VALUES
('MMM Hà Nội', 'Hà Nội', 150),
('MMM Hồ Chí Minh', 'TP.HCM', 120),
('MMM Đà Nẵng', 'Đà Nẵng', 100);

INSERT INTO movies (title, genre, duration, release_date, ticket_price, image_url) VALUES
('Avengers: Endgame', 'Hành động', 181, '2019-04-26', 120000, 'avengers.jpg'),
('Fast & Furious 9', 'Hành động', 143, '2021-06-25', 100000, 'fast9.jpg'),
('Spider-Man: No Way Home', 'Siêu anh hùng', 148, '2021-12-17', 110000, 'spiderman.jpg');

INSERT INTO showtimes (movie_id, theater_id, showtime, available_seats) VALUES
(1, 1, '2025-03-20 18:00:00', 150),
(1, 2, '2025-03-20 20:00:00', 120),
(2, 1, '2025-03-21 19:00:00', 150),
(3, 3, '2025-03-22 21:00:00', 100);

INSERT INTO bookings (client_id, showtime_id, num_tickets, total_price) VALUES
(2, 1, 2, 240000),
(2, 3, 3, 300000),
(3, 4, 1, 110000);
